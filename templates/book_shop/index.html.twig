{% extends 'client_layout.html.twig' %}

{% block stylesheets %}
    {{ parent() }}

    <!-- CSS -->
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.11.2/build/css/alertify.min.css"/>
    <!-- Default theme -->
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.11.2/build/css/themes/default.min.css"/>
{% endblock %}
{% block body %}
    <div class="row justify-content-center">
        <div class="col-lg-12">
            <div class="row row-grid">
                {% for item in books %}
                        <div class="col-lg-4">
                            <div class="card card-lift--hover shadow border-1">
                                <div class="row">
                                    <div class="col">
                                        <div class="card-img-top pt-2">
                                            <img src="{{ vich_uploader_asset(item.book, 'coverFile')|default(asset('assets/img/icons/reading.svg')) }}"
                                                 class="col-md-6" alt="">
                                        </div>
                                    </div>
                                    <div class="col-auto">
                                        <div class="pt-2 pr-2">
                                            <p class="badge badge-info">{{ item.book.category.title }}</p>
                                        </div>
                                    </div>
                                </div>

                                <div class="card-body card-body plr-5">
                                    <div class="pb-2">
                                        <h4 class="mb-0 text-sm text-blue">{{ 'Book title'|trans }}</h4>
                                        <p class="text-sm mb-0">{{ item.book.title }}</p>
                                    </div>

                                    <div class="pb-2">
                                        <h4 class="mb-0 text-sm text-blue">{{ 'Description'|trans }}</h4>
                                        <p class="text-sm mb-0">{{ item.book.description }}</p>
                                    </div>

                                    <div class="pb-2">
                                        <h4 class="mb-0 text-sm text-blue">{{ 'Quantity available'|trans }}</h4>
                                        <p class="text-sm mb-0">{{ item.book.quantity - item.reservedBooks }} {{ 'Book'|trans }}</p>
                                    </div>

                                    <div class="pb-2">
                                        <h4 class="mb-0 text-sm text-blue">{{ 'Section'|trans }}</h4>
                                        <p class="text-sm mb-0">{{ item.book.section|default('---') }}</p>
                                    </div>

                                    <div class="pb-2">
                                        <h4 class="mb-0 text-sm text-blue">{{ 'International Standard Book Number'|trans }}</h4>
                                        <p class="text-sm mb-0">{{ item.book.isbn|default('---') }}</p>
                                    </div>
                                </div>
                                <div class="card-footer">
                                    <button type="button" class="btn btn-sm btn-primary mb-3" data-toggle="modal"
                                            data-target="#modal-{{ item.book.id }}">
                                        {{ 'Borrow this book'|trans }}
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="modal fade" id="modal-{{ item.book.id }}" tabindex="-1" role="dialog"
                             aria-labelledby="modal-default" aria-hidden="true">
                            <form action="{{ path('user_make_reservation') }}" method="post" class="modal-dialog modal-dialog" role="document">
                                <div class="modal-content">
                                    <div class="modal-header border-1">
                                        <h2 class="modal-title"
                                            id="modal-title-default"><i class="fas fa-item.book"></i> {{ 'Create a borrowing request'|trans }}</h2>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">Ã—</span>
                                        </button>
                                    </div>

                                    <div class="modal-body">
                                        <div class="form-group">
                                            <label class="form-control-label" for="js-start-date">{{ "Borrowing quantity"|trans }}</label>
                                            <div class="input-group input-group-alternative mb-4">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text"> <i class="ni ni-books"></i></span>
                                                </div>
                                                <input class="form-control form-control-alternative" name="quantity" type="number" value="1">
                                            </div>
                                        </div>
                                        <div class="input-daterange datepicker row align-items-center">
                                            <div class="col">
                                                <div class="form-group">
                                                    <label class="form-control-label" for="js-start-date">{{ "Start borrowing date"|trans }}</label>
                                                    <div class="input-group input-group-alternative">
                                                        <div class="input-group-prepend">
                                                            <span class="input-group-text"><i class="ni ni-calendar-grid-58"></i></span>
                                                        </div>

                                                        <input id="js-start-date" name="start_borrowing_date" class="form-control" placeholder="Start date" type="text" value="{{ date('now')|date('m/d/Y') }}">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col">
                                                <div class="form-group">
                                                    <label class="form-control-label" for="js-end-date">{{ "End borrowing date"|trans }}</label>
                                                    <div class="input-group input-group-alternative">
                                                        <div class="input-group-prepend">
                                                            <span class="input-group-text"><i class="ni ni-calendar-grid-58"></i></span>
                                                        </div>
                                                        <input class="form-control" name="end_borrowing_date" placeholder="End date" type="text" value="{{ date('+ 1 month')|date('m/d/Y') }}">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <input type="hidden" name="book" value="{{ item.book.id }}">
                                    <input type="hidden" name="_token" value="{{ csrf_token('make_reservation' ~ item.book.id) }}">

                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-success js-make-reservation" data-dismiss="modal"><i class="fas fa-plus-circle"></i> {{ 'Borrow now'|trans }}</button>
                                        <button type="button" class="btn btn-link  ml-auto"
                                                data-dismiss="modal">{{ 'Close'|trans }}</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                {% else %}
                    <div class="col-lg-12">
                        <div class="card card-lift--hover shadow">
                            <div class="card-body text-center plr-5">
                                <img class="col-2 pb-4" src="{{ asset('assets/img/icons/search.svg') }}" alt="">
                                <h2>{{ "No results were found to match your search item"|trans }}</h2>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>

            {# display navigation #}
            <div aria-label="Page navigation example">
                {{ knp_pagination_render(books) }}
            </div>
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <!-- JavaScript -->
    <script src="//cdn.jsdelivr.net/npm/alertifyjs@1.11.2/build/alertify.min.js"></script>
    <script src="{{ asset('assets/js/make-reservation.js') }}"></script>
{% endblock %}